{% extends "base.html" %}
{% load static %}

{% block title %}{{ product.name }}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/product_detail.css' %}">
{% endblock %}

{% block content %}
<nav class="pd-breadcrumb" aria-label="Breadcrumb">
  <ol>
    <li><a href="{% url 'home' %}">Home</a></li>
    {% if product.sub_category %}
    <li><a href="{% url 'product_list' %}?l1={{ product.sub_category|urlencode }}">{{ product.sub_category }}</a></li>
    {% endif %}
    {% if product.sub_subcategory %}
    <li><a href="{% url 'product_list' %}?l1={{ product.sub_category|urlencode }}&l2={{ product.sub_subcategory|urlencode }}">{{ product.sub_subcategory }}</a></li>
    {% endif %}
    <li aria-current="page">{{ product.name }}</li>
  </ol>
  {% if product.list_position %}
    <span class="pd-meta">Shelf: {{ product.list_position }}</span>
  {% endif %}
  {% if product.variant %}
    <span class="pd-meta">Pack: {{ product.variant }}</span>
  {% endif %}
  {% if product.vat_rate %}
    <span class="pd-meta">VAT: {{ product.get_vat_rate_display }}</span>
  {% endif %}
  </nav>

<section class="pd-grid">
  <div class="pd-gallery">
    <div class="pd-image">
      <img src="{% if product.image_url %}{{ product.image_url }}{% else %}{% static 'images/fresh_products.jpg' %}{% endif %}"
           alt="{{ product.name }}"
           loading="lazy">
    </div>
  </div>

  <div class="pd-info">
    <h1 class="pd-title">{{ product.name }}</h1>
    <div class="pd-price-row">
      <span class="pd-price">£{{ product.price|floatformat:2 }}</span>
      {% if product.rsp %}
      <span class="pd-rsp">RSP: £{{ product.rsp|floatformat:2 }}</span>
      {% endif %}
    </div>

    <form method="POST" action="{% url 'add_to_cart' product.id %}" class="pd-buy">
      {% csrf_token %}
      <input type="hidden" name="return_to" value="{{ request.get_full_path }}">
      <label for="qty" class="visually-hidden">Quantity</label>
      <input id="qty" type="number" name="quantity" value="1" min="1" step="1">
      <button type="submit" class="pd-btn">Add to cart</button>
    </form>

    {% if not user.is_authenticated %}
    <p class="pd-login">Please <a href="{% url 'login' %}">log in</a> to complete purchase.</p>
    {% endif %}

    <div class="pd-specs">
      <div><span>Retail EAN</span><strong>{{ product.retail_EAN|default:"N/A" }}</strong></div>
      <div><span>Main Category</span><strong>{{ product.main_category|default:"N/A" }}</strong></div>
      <div><span>Sub Category</span><strong>{{ product.sub_category|default:"N/A" }}</strong></div>
      <div><span>Sub-subcategory</span><strong>{{ product.sub_subcategory|default:"N/A" }}</strong></div>
      <div><span>Variant</span><strong>{{ product.variant|default:"N/A" }}</strong></div>
      <div><span>Promotion Ends</span>
        <strong>{% if product.promotion_end_date %}{{ product.promotion_end_date|date:"d M Y" }}{% else %}N/A{% endif %}</strong>
      </div>
    </div>

    <p class="pd-disclaimer">Images and product information are for illustration only and may differ from the actual product.</p>
  </div>
</section>
{% endblock %}
