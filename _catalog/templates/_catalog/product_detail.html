{% extends "base.html" %}
{% load static catalog_extras %}

{% block title %}{{ product.name }}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/product_detail.css' %}">
{% endblock %}

{% block content %}
{% comment %} <nav class="pd-breadcrumb" aria-label="Breadcrumb">
  <ol>
    <li><a href="{% url 'home' %}">Home</a></li>
    {% if product.sub_category %}
    <li><a href="{% url 'product_list' %}?l1={{ product.sub_category|urlencode }}">{{ product.sub_category }}</a></li>
    {% endif %}
    {% if product.sub_subcategory %}
    <li><a href="{% url 'product_list' %}?l1={{ product.sub_category|urlencode }}&l2={{ product.sub_subcategory|urlencode }}">{{ product.sub_subcategory }}</a></li>
    {% endif %}
    <li aria-current="page">{{ product.name }}</li>
  </ol>
  {% if product.list_position %}
    <span class="pd-meta">Shelf: {{ product.list_position }}</span>
  {% endif %}
  {% if product.variant %}
    <span class="pd-meta">Pack: {{ product.variant }}</span>
  {% endif %}
  {% if product.vat_rate %}
    <span class="pd-meta">VAT: {{ product.get_vat_rate_display }}</span>
  {% endif %}
</nav> {% endcomment %}

<section class="pd-grid">
  <div class="pd-gallery">
    <div class="pd-image">
      <a href="#img-modal" class="pd-zoom" aria-label="Zoom image" title="Product Detail" >
        <img src="{% if product.image_url %}{{ product.image_url }}{% else %}{% static 'images/fresh_products.jpg' %}{% endif %}"
             alt="{{ product.name }}"
             loading="lazy"
             title="Product Detail">
      </a>
    </div>
  </div>

  <div class="pd-info">
    <h1 class="pd-title">{{ product.name }}</h1>
    <div class="pd-price-row">
      {% if user.is_superuser %}
      <span class="pd-price">£{{ product.price|floatformat:2 }}</span>
      {% endif %}
      {% if product.rsp %}
      <span class="pd-rsp">£{{ product.rsp|floatformat:2 }}</span>
      {% endif %}
    </div>

    {% if product.is_bulk and product.bulk_total_price %}
    <div class="pd-pack-info">
      Pack total &pound;{{ product.bulk_total_price|floatformat:2 }} for {{ product.pack_amount }} units
    </div>
    {% endif %}

    <form method="POST" action="{% url 'add_to_cart' product.id %}" class="pd-buy">
      {% csrf_token %}
      <input type="hidden" name="return_to" value="{{ request.get_full_path }}">
      <label for="qty" class="visually-hidden">Quantity</label>
      <input id="qty" type="number" name="quantity" value="1" min="1" step="1">
      <button type="submit" class="pd-btn">Add to cart</button>
    </form>

    {% if not user.is_authenticated %}
    <p class="pd-login">Please <a href="{% url 'login' %}">log in</a> to complete purchase.</p>
    {% endif %}

    <dl class="pd-specs">
      <dt>Retail EAN</dt><dd>{{ product.retail_EAN|default:"N/A" }}</dd>
      <dt>Main Category</dt><dd>{{ product.main_category|default:"N/A" }}</dd>
      <dt>Sub Category</dt><dd>{{ product.sub_category|default:"N/A" }}</dd>
      <dt>Sub-subcategory</dt><dd>{{ product.sub_subcategory|default:"N/A" }}</dd>
      <dt>Variant</dt><dd>{{ product.variant|default:"N/A" }}</dd>
      <dt>Promotion Ends</dt>
      <dd>{% if product.promotion_end_date %}{{ product.promotion_end_date|date:"d M Y" }}{% else %}N/A{% endif %}</dd>
    </dl>

    <p class="pd-disclaimer">Images and product information are for illustration only and may differ from the actual product.</p>
  </div>
</section>

<section class="pd-details">
  {% if product.description %}
  <details class="pd-accordion" open>
    <summary><strong>Description</strong></summary>
    <div class="pd-section-body pd-multiline">{{ product.description|linebreaksbr }}</div>
  </details>
  {% endif %}

  {% if product.ingredients_nutrition %}
    <details class="pd-accordion">
      <summary><strong>Ingredients/Nutrition</strong></summary>
      <div class="pd-section-body">{{ product.ingredients_nutrition|render_ingredients_nutrition|safe }}</div>
    </details>
  {% endif %}

  {% if product.other_info %}
    <details class="pd-accordion">
      <summary><strong>
        Other Info
      </strong></summary>
      <div class="pd-section-body pd-multiline">{{ product.other_info|linebreaksbr }}</div>
    </details>
  {% endif %}
</section>

<!-- CSS-only lightbox using :target -->
{% comment %} <div id="img-modal" class="pd-lightbox" aria-modal="true" role="dialog">
  <a href="#" class="pd-lightbox-close" aria-label="Close"></a>
  <img src="{% if product.image_url %}{{ product.image_url }}{% else %}{% static 'images/fresh_products.jpg' %}{% endif %}"
       alt="{{ product.name }}"
       title="Product Detail">
  <div class="pd-lightbox-caption">{{ product.name }}</div>
  <a href="#" class="pd-lightbox-backdrop" aria-hidden="true"></a>
  
</div> {% endcomment %}
{% endblock %}
